language: go
dist: bionic
os: linux
go: 1.18.x

notifications:
  slack:
    rooms:
      - secure: "lJHDtsla4rDNbmsxxDjCaHPhrqNcSIFrzPNnK7sPucf+NG0Okfeqzeh/qy0AjnVUBusnnqlXdzpvPLyZF5KcTSLpfgFWINXqKvOy8cBbLSXKPwSOnB7btbv4Cx36YnJTBzdVjSzuM7biypCtSv2kI10rHwLeaA6r4ZMEog83CWbLKmxq6+sDQGALPrfy5uz29BIJxYTIcG2gLzmof5Fe9oIZCTg+RO363h9+OY+NeHmfrN3jtBUXT9K3QYIsmPDazjKSQhQ1yAo1+2MM1ajpM88Up5VXJkOc+KUnunqdRjhrVzcvVDwZW9ZtIzNkddWUou5GzusMpZ0xXfBUqRbRYdmHMwV4s6oLdW3ysioWj4HJXGY5zoQoSifH9RR5YqIBNYk4JOy5eeRRSZr84UU5iHsKnrQHYzGYl12e3zu5JzYTdMS7NICk/AHREMs1YLyV96IYhzZyNLfWA6U/k/r33kd73r351w5i9wVZzgl1v4Jkh2glT7DspBN05GwoqF8UhfV95YpyPgF40Ihvxe7MPwjv6rk10Tki7uECoZyzcpeZlcPYS9Nrsocg4RPNt/IEokUG3jrC0V7A4acVIdjPWw5Yvpeek+fC1qnABKt0c9NzaPtWTXEPaHBzIdGKQGVeno5x2XrGeonu0O8mSfnbuqmVb6nIa+0wrM7OKWUlHFM="
    on_success: change
    on_failure: change

branches:
  only:
    - master

jobs:
  include:
  - stage: lint
    script: helm lint yilu-common --set image.tag="test" --set serviceName="ci-test"
    install: ./scripts/install_toolchain.sh

  - stage: package and publish
    script: ./scripts/publish_chart.sh
#   TODO later consider using gh-pages branch
    if: type != pull_request AND ( branch = master )
    install: ./scripts/install_toolchain.sh
    env:
      # TRAVIS_GITHUB_TOKEN
      - secure: "PfEMNr/LRt/f6Zr4QRUumgOTK447FSqF3igEPdU5gCwF8AHoG676INa2ACF2E742nwKeki8nllLVajWbAZKGDFC2esUd5QXAorKxmVls02xbJbgQmrEXHDRG4850fh04mxjjm65jElg10PiozvfKavxYuaAUHKYut143I1PLZQfyC46go2qpNRy0zsAQyVsIib8ZUqjEcV4nby9l8wBNXXhNw9FuyJNKDqRuIj9QDfUjRZ8+eOGEHKnJyDnjP6SPYq7Q16ue/KZzm9fPma85J6DbqnQx7Yi+1ON3bs6dC413BjesFiiw/55fuo6CsKPthGhgzMtqEynD/f4KJl0fl2919Tv8efGmaIWt4cF5n/ED+Ajf8W4pzrsl9FFG55t6M49Eeep55WCvECrnWCD69W6WLC5HohZexXxTSwosLKkJCtfWt1PFE8yJw0Q4gl8PD4Ly6YO9el9lJRyxSpKI2DOtphBIkmhqMJ+wO6JXo/Zohb3JeR4uYfvjw1mZxgAg6d3Df9lMJYgxhdxJ/za7bsRaWU4WAXVlx6m2ms0mc24p2qDNAAZWb6GxCsE+ajQi02koAgU6JYKgTr/36ieGwsejmht0XZVADlU1FNvZwcihd3HL3u/Tucum0BHOfldYJ+2SL81cJwS3tCzp7rYrZ2rjoziGc5K3ETwtfEUl5+U="
